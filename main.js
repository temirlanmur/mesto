(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n){var r=e.data,o=e.isLiked,i=e.isRemovable,a=e.handleCardClick,u=e.handleCardLike,s=e.handleCardDelete;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._id=r._id,this._name=r.name,this._link=r.link,this._likesCount=r.likes.length,this._isLiked=o,this._isRemovable=i,this._handleCardClick=a,this._handleCardLike=u,this._handleCardDelete=s,this._cardSelector=n}var n,r;return n=t,(r=[{key:"_setLikes",value:function(e){var t=e.likesCount,n=e.isLiked;this._likesCount=t,this._isLiked=n}},{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var e=this;this._element.querySelector(".element__popup-btn").addEventListener("click",(function(){e._handleCardClick(e._name,e._link)})),this._element.querySelector(".element__like-btn").addEventListener("click",(function(){e._handleCardLike({cardId:e._id,isLiked:e._isLiked,updateState:e._updateLikesState.bind(e)})})),this._isRemovable&&this._element.querySelector(".element__trash-btn").addEventListener("click",(function(){e._handleCardDelete(e._id,e._removeCard.bind(e))}))}},{key:"_updateLikesState",value:function(e,t){this._setLikes({likesCount:e,isLiked:t}),this._updateLikes()}},{key:"_removeCard",value:function(){this._element.remove()}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._isRemovable||this._element.querySelector(".element__trash-btn").remove(),this._cardImage=this._element.querySelector(".element__img"),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._element.querySelector(".element__title").textContent=this._name,this._likesCountElement=this._element.querySelector(".element__like-count"),this._likeButton=this._element.querySelector(".element__like-btn"),this._updateLikes(),this._setEventListeners(),this._element}},{key:"_updateLikes",value:function(){this._likesCountElement.textContent=this._likesCount,this._toggleLikeButton()}},{key:"_toggleLikeButton",value:function(){this._isLiked?this._likeButton.classList.add("element__like-btn_active"):this._likeButton.classList.remove("element__like-btn_active")}}])&&e(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t){var n=t.profileNameSelector,r=t.profileDescriptionSelector,o=t.profileAvatarSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._profileName=document.querySelector(n),this._profileDescription=document.querySelector(r),this._profileAvatar=document.querySelector(o)}var t,r;return t=e,(r=[{key:"getUserInfo",value:function(){return{profileName:this._profileName.textContent,profileDescription:this._profileDescription.textContent}}},{key:"setUserInfo",value:function(e){var t=e.profileName,n=e.profileDescription;this._profileName.textContent=t,this._profileDescription.textContent=n}},{key:"setAvatar",value:function(e){this._profileAvatar.src=e}}])&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=document.querySelector(t)}var t,n;return t=e,(n=[{key:"appendItem",value:function(e){this._container.append(e)}},{key:"prependItem",value:function(e){this._container.prepend(e)}},{key:"renderItems",value:function(e){var t=e.items,n=e.renderer;this.clearItems(),t.forEach(n)}},{key:"clearItems",value:function(){this._container.innerHTML=""}}])&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t){var n,r,o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(e){"Escape"===e.key&&o.close()},(n="_handleEscClose")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this._popup=document.querySelector(t)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("click",(function(t){(t.target.classList.contains("popup__close-btn")||t.target.classList.contains("popup_opened"))&&e.close()}))}}])&&a(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=f(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},l.apply(this,arguments)}function f(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}function p(e,t){return p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},p(e,t)}function h(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(r);if(o){var n=d(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._form=n._popup.querySelector(".popup__form"),n._submitButton=n._form.querySelector(".popup__submit-btn"),n._buttonDefaultText=n._submitButton.textContent,n._handleFormSubmit=e,n}return t=a,(n=[{key:"close",value:function(){this._form.reset(),l(d(a.prototype),"close",this).call(this)}},{key:"renderLoading",value:function(e){this._submitButton.textContent=e?"Сохранение..":this._buttonDefaultText}},{key:"setEventListeners",value:function(){var e=this;l(d(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e.renderLoading(!0),e._handleFormSubmit(e._getInputValues())}))}},{key:"_getInputValues",value:function(){var e=this;return this._formValues={},Array.from(this._form.elements).forEach((function(t){return e._formValues[t.name]=t.value})),this._formValues}}])&&c(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(u);function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(){return v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=b(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},v.apply(this,arguments)}function b(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}function k(e,t){return k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},k(e,t)}function g(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}var S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&k(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=w(r);if(o){var n=w(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._popupImage=t._popup.querySelector(".popup__image"),t._popupImageCaption=t._popup.querySelector(".popup__img-caption"),t}return t=a,(n=[{key:"open",value:function(e,t){this._popupImage.src=t,this._popupImage.alt=e,this._popupImageCaption.textContent=e,v(w(a.prototype),"open",this).call(this)}}])&&m(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(u);function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(){return L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=O(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},L.apply(this,arguments)}function O(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}function P(e,t){return P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},P(e,t)}function j(e,t){if(t&&("object"===C(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}var R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&P(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=I(r);if(o){var n=I(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return j(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._submitButton=t._popup.querySelector(".popup__submit-btn"),t}return t=a,(n=[{key:"setActionOnSubmit",value:function(e){this._actionOnSubmit=e}},{key:"setEventListeners",value:function(){var e=this;L(I(a.prototype),"setEventListeners",this).call(this),this._submitButton.addEventListener("click",(function(t){e._actionOnSubmit()}))}}])&&E(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(u);function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._settings=t,this._form=n,this._formInputsArray=Array.from(n.querySelectorAll(t.inputSelector)),this._formSubmitButton=n.querySelector(t.submitButtonSelector)}var t,n;return t=e,(n=[{key:"_setEventListeners",value:function(){var e=this;this._formInputsArray.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e.toggleButtonState()}))}))}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}},{key:"_showInputError",value:function(e){var t=this._form.querySelector(".".concat(e.id,"-error"));e.classList.add(this._settings.inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._settings.errorClass)}},{key:"_hideInputError",value:function(e){var t=this._form.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._settings.inputErrorClass),t.textContent="",t.classList.remove(this._settings.errorClass)}},{key:"toggleButtonState",value:function(){this._hasInvalidInputState()?(this._formSubmitButton.classList.add(this._settings.inactiveButtonClass),this._formSubmitButton.disabled=!0):(this._formSubmitButton.classList.remove(this._settings.inactiveButtonClass),this._formSubmitButton.disabled=!1)}},{key:"_hasInvalidInputState",value:function(){return this._formInputsArray.some((function(e){return!e.validity.valid}))}},{key:"enableValidation",value:function(){this._setEventListeners()}},{key:"resetErrors",value:function(){var e=this;this._formInputsArray.forEach((function(t){e._hideInputError(t)}))}}])&&B(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=function(){function e(t){var n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e))},(n="_handleResponse")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this._baseUrl=t.baseUrl,this._headers=t.headers}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return fetch(this._baseUrl+"/users/me",{method:"GET",headers:this._headers}).then(this._handleResponse)}},{key:"getCards",value:function(){return fetch(this._baseUrl+"/cards",{method:"GET",headers:this._headers}).then(this._handleResponse)}},{key:"getData",value:function(){return Promise.all([this.getUserInfo(),this.getCards()])}},{key:"updateProfile",value:function(e){var t=e.name,n=e.about;return fetch(this._baseUrl+"/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:n})}).then(this._handleResponse)}},{key:"updateProfileAvatar",value:function(e){return fetch(this._baseUrl+"/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._handleResponse)}},{key:"addCard",value:function(e){var t=e.name,n=e.link;return fetch(this._baseUrl+"/cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:n})}).then(this._handleResponse)}},{key:"addLikeToCard",value:function(e){return fetch(this._baseUrl+"/cards/"+e+"/likes",{method:"PUT",headers:this._headers}).then(this._handleResponse)}},{key:"deleteLikeFromCard",value:function(e){return fetch(this._baseUrl+"/cards/"+e+"/likes",{method:"DELETE",headers:this._headers}).then(this._handleResponse)}},{key:"deleteCard",value:function(e){return fetch(this._baseUrl+"/cards/"+e,{method:"DELETE",headers:this._headers}).then(this._handleResponse)}}])&&D(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),A={formSelector:".popup__form",inputSelector:".popup__input-field",submitButtonSelector:".popup__submit-btn",inactiveButtonClass:"popup__submit-btn_inactive",inputErrorClass:"popup__input-field_type_error",errorClass:"popup__input-error_active"},U=document.forms.cardCreateForm,x=document.querySelector(".profile__add-btn"),N=document.forms.profileEditForm,V=N.elements.profileName,F=N.elements.profileDescription,H=document.querySelector(".profile__edit-btn"),J=document.forms.avatarUpdateForm,G=document.querySelector(".profile__update-avatar-btn"),M=new T(A,U),z=new i(".elements"),K=new S(".popup_type_image"),Q=new R(".popup_type_delete-card"),W=new T(A,N),X=new T(A,J),Y=new r({profileNameSelector:".profile__name",profileDescriptionSelector:".profile__description",profileAvatarSelector:".profile__avatar"}),Z=new q({baseUrl:"https://nomoreparties.co/v1/cohort-40",headers:{authorization:"676c0732-35dd-41a8-a513-8cdd7e2d2f94","Content-Type":"application/json"}}),$=new y((function(e){Z.updateProfile({name:e.profileName,about:e.profileDescription}).then((function(t){Y.setUserInfo(e),$.close()})).catch((function(e){return console.log(e)})).finally((function(e){return $.renderLoading(!1)}))}),".popup_type_edit-profile"),ee=new y((function(e){Z.updateProfileAvatar(e.avatarLink).then((function(e){Y.setAvatar(e.avatar),ee.close()})).catch((function(e){return console.log(e)})).finally((function(e){return ee.renderLoading(!1)}))}),".popup_type_update-avatar"),te=function(e,t){return K.open(e,t)},ne=function(e,t){Q.setActionOnSubmit((function(n){Z.deleteCard(e).then((function(e){t(),Q.close()})).catch((function(e){return console.log(e)}))})),Q.open()},re=new y((function(e){Z.addCard({name:e.placeName,link:e.placeLink}).then((function(e){z.prependItem(ie(e,!1,!0)),re.close()})).catch((function(e){return console.log(e)})).finally((function(e){return re.renderLoading(!1)}))}),".popup_type_add-card"),oe=function(e){var t=e.cardId,n=e.isLiked,r=e.updateState;n?Z.deleteLikeFromCard(t).then((function(e){return r(e.likes.length,!n)})).catch((function(e){return console.log(e)})):Z.addLikeToCard(t).then((function(e){return r(e.likes.length,!n)})).catch((function(e){return console.log(e)}))},ie=function(e,n,r){return new t({data:e,isLiked:n,isRemovable:r,handleCardClick:te,handleCardLike:oe,handleCardDelete:ne},"#element-template").generateCard()};Z.getData().then((function(e){var t=e[0],n=e[1];Y.setUserInfo({profileName:t.name,profileDescription:t.about}),Y.setAvatar(t.avatar);var r=t._id;z.renderItems({items:n,renderer:function(e){var t=e.likes.some((function(e){return e._id===r})),n=e.owner._id===r,o=ie(e,t,n);z.appendItem(o)}})})).catch((function(e){return console.log(e)})),K.setEventListeners(),re.setEventListeners(),Q.setEventListeners(),x.addEventListener("click",(function(){return M.resetErrors(),M.toggleButtonState(),void re.open()})),$.setEventListeners(),ee.setEventListeners(),H.addEventListener("click",(function(){return e=Y.getUserInfo(),V.value=e.profileName,F.value=e.profileDescription,W.resetErrors(),W.toggleButtonState(),void $.open();var e})),G.addEventListener("click",(function(){return X.resetErrors(),X.toggleButtonState(),void ee.open()})),M.enableValidation(),W.enableValidation(),X.enableValidation()})();